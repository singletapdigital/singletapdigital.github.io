(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{kJmD:function(e,t,o){"use strict";o.r(t),o.d(t,"BookingEventPageModule",(function(){return k}));var n=o("UKGz"),i=o("pMoy"),r=o("SVse"),s=o("s7LF"),a=o("sZkV"),c=o("iInd"),l=o("mrSG"),b=o("jp9Y"),g=o("aDUK"),u=o("8Y7J"),d=o("t0hA"),m=o("Y+pZ"),v=o("T/V+");const h=[{path:"",component:(()=>{class e{constructor(e,t,o,n,i){this.formBuilder=e,this.activatedRoute=t,this.router=o,this.toastController=n,this.bookingService=i,this.selectedEventUUID="",this.selectedEventName="",this.selectedEventCapacity=40,this.currentPersonBookingCount=0;const r=e.group(b.a.createPersonForm());this.bookingForm=r,t.queryParams.subscribe(e=>{console.log("BookingEventPage -> params",e);const t=o.getCurrentNavigation();if(null===t||void 0===t.extras.state)return void o.navigateByUrl("/").then(e=>{console.log("BookingEventPage -> reNavigate. No navExtras found to book",e)}).catch(e=>{console.log("BookingEventPage -> reNavigate error",e)});const{extras:{state:n}}=t,{randomUUID:i,eventName:r,eventCapacity:s}=n;this.selectedEventUUID=i,this.selectedEventName=r,this.selectedEventCapacity=s})}get isCapacityLocked(){return this.currentPersonBookingCount>=this.selectedEventCapacity}get isRegistrationAllowed(){return!this.isCapacityLocked}ngOnInit(){}onSubmitForm(e,t,o=this.selectedEventUUID,n=this.bookingForm,i=this.bookingService){console.log("BookingEventPage -> clickSubmitForm -> eventUUID",o,n.value);const r=n.value;e.control.setErrors({invalid:"Saving form..."}),this.presentToast().then(e=>{}).catch(e=>{}),i.bookPersonByEventUUID(o,r).subscribe(({errors:e,data:t})=>{var n;if(void 0!==e||(null==e?void 0:e.length)>0||void 0===(null===(n=t.insert_Person_one)||void 0===n?void 0:n.personFirstName))return console.log("BookingEventPage -> ngOnInit -> data",t),console.log("BookingEventPage -> ngOnInit -> errors",e),console.error("Failed to save"),void this.presentToast("Unable to book. \u{1f6a7}").then(e=>{}).catch(e=>{});const i=t.insert_Person_one,s=Object.assign({selectedEventUUID:o},r);console.log("BookingEventPage -> ngOnInit -> returnedPerson",i),console.log("BookingEventPage -> ngOnInit -> personFormSubmission",s);const a=JSON.stringify(i),c=JSON.stringify(s);console.log("BookingEventPage -> ngOnInit -> returnedPersonSuccessLocalStorageText personFormSubmissionLocalStorageText",a,c),localStorage.setItem(g.a,a),localStorage.setItem(g.b,c),this.presentToast("\u{1f516}\u{1f4d1}Booking successful \u{1f4be}\u{1f9fe}\u{1f4dd}\u{1f4da}\u{1f4d7}\u{1f4d6}").then(e=>{}).catch(e=>{})})}presentToast(e="Loading... \u{1f503}",t=this.toastController){return Object(l.a)(this,void 0,void 0,(function*(){return(yield t.create({message:e,duration:4e3,animated:!0,translucent:!0})).present().then(()=>{console.log("Toast presented")})}))}}return e.\u0275fac=function(t){return new(t||e)(u.Jb(s.b),u.Jb(c.a),u.Jb(c.g),u.Jb(a.E),u.Jb(d.a))},e.\u0275cmp=u.Db({type:e,selectors:[["app-booking-event"]],decls:28,vars:6,consts:[[3,"translucent"],["pageTitle","Book event"],[3,"formGroup","ngSubmit"],["f","ngForm"],["src","/assets/images/emp-cmca-logo-small-172x172-placeholder.jpg","alt","Placeholder-image-church"],[2,"padding-left","0.5em","margin-bottom","0em"],["input",""],[3,"eventName"],["type","submit","color","cobaltblue",3,"disabled","click"],["name","person-add-outline"],["type","submit","mat-button","","color","primary","hidden","",3,"disabled"],["name","document-text"]],template:function(e,t){if(1&e){const e=u.Nb();u.Mb(0,"ion-header",0),u.Kb(1,"app-custom-header",1),u.Lb(),u.Mb(2,"ion-content"),u.Mb(3,"form",2,3),u.Ub("ngSubmit",(function(o){u.ic(e);const n=u.hc(4);return t.onSubmitForm(n,o)})),u.Mb(5,"ion-list"),u.Mb(6,"ion-list-header"),u.Mb(7,"ion-avatar"),u.Kb(8,"img",4),u.Lb(),u.Mb(9,"ion-label"),u.Mb(10,"h1",5),u.nc(11),u.Lb(),u.Lb(),u.Lb(),u.Mb(12,"ion-item",6),u.nc(13," Item 1"),u.Lb(),u.Mb(14,"ion-item",6),u.nc(15," 2"),u.Lb(),u.Mb(16,"ion-item",6),u.nc(17," 23tw8gh 24hr9 23 2h r2h 9382 8932"),u.Lb(),u.Lb(),u.Kb(18,"app-covid-declaration",7),u.Mb(19,"ion-row"),u.Mb(20,"ion-col"),u.Mb(21,"div"),u.Mb(22,"ion-button",8),u.Ub("click",(function(o){u.ic(e);const n=u.hc(4);return t.onSubmitForm(n,o)})),u.Kb(23,"ion-icon",9),u.nc(24," Create Booking "),u.Lb(),u.Mb(25,"button",10),u.Kb(26,"ion-icon",11),u.nc(27," Add Person (enter) "),u.Lb(),u.Lb(),u.Lb(),u.Lb(),u.Lb(),u.Lb()}2&e&&(u.ec("translucent",!0),u.zb(3),u.ec("formGroup",t.bookingForm),u.zb(8),u.oc(t.selectedEventName),u.zb(7),u.ec("eventName",t.selectedEventName),u.zb(4),u.ec("disabled",t.bookingForm.invalid),u.zb(3),u.ec("disabled",t.bookingForm.invalid))},directives:[a.l,m.a,a.j,s.o,s.k,s.e,a.t,a.u,a.b,a.s,a.o,v.a,a.w,a.i,a.e,a.m],styles:[""]}),e})()}];let p=(()=>{class e{}return e.\u0275mod=u.Hb({type:e}),e.\u0275inj=u.Gb({factory:function(t){return new(t||e)},imports:[[c.i.forChild(h)],c.i]}),e})(),k=(()=>{class e{}return e.\u0275mod=u.Hb({type:e}),e.\u0275inj=u.Gb({factory:function(t){return new(t||e)},imports:[[r.c,s.f,s.l,a.A,n.a,i.b,p]]}),e})()}}]);