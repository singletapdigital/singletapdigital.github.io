!function(){function e(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function n(e,n){for(var o=0;o<n.length;o++){var t=n[o];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function o(e,o,t){return o&&n(e.prototype,o),t&&n(e,t),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{kJmD:function(n,t,i){"use strict";i.r(t),i.d(t,"BookingEventPageModule",(function(){return F}));var r,a=i("UKGz"),c=i("pMoy"),s=i("SVse"),l=i("s7LF"),u=i("sZkV"),d=i("iInd"),g=i("mrSG"),b=i("8Y7J"),m=i("T/V+"),v=((r=function(){function n(o){e(this,n),this.modalController=o,this.eventName="",console.log("ModalPage -> constructor")}return o(n,[{key:"ngOnInit",value:function(){console.log("ModalPage -> ngOnInit")}},{key:"checkChange",value:function(e){console.log("ModalPage -> checkChange ",e),this.isDeclarationChecked=e.checked,e.checked&&this.dismiss(e.checked)}},{key:"dismiss",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.isDeclarationChecked,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.modalController;n.dismiss({isDeclarationChecked:e}).then((function(e){console.log("ModalPage -> constructor -> a",e)})).catch((function(e){console.log("ModalPage -> constructor -> err",e)}))}}]),n}()).\u0275fac=function(e){return new(e||r)(b.Jb(u.F))},r.\u0275cmp=b.Db({type:r,selectors:[["app-modal"]],inputs:{eventName:"eventName"},decls:13,vars:1,consts:[["color","cobaltmonochrome"],["text-left",""],["slot","end","icon-only","","color","triadicred",3,"click"],[3,"eventName"],["size","10"],["id","check-declaration-modal","aria-label","b","required","",3,"change"]],template:function(e,n){1&e&&(b.Ob(0,"ion-toolbar",0),b.Ob(1,"ion-title",1),b.qc(2,"COVID declaration "),b.Nb(),b.Ob(3,"ion-button",2),b.Wb("click",(function(){return n.dismiss(n.isDeclarationChecked)})),b.qc(4," Dismiss "),b.Nb(),b.Nb(),b.Ob(5,"ion-grid"),b.Kb(6,"app-covid-declaration",3),b.Ob(7,"ion-row"),b.Ob(8,"ion-col",4),b.Ob(9,"mat-checkbox",5),b.Wb("change",(function(e){return n.checkChange(e)})),b.qc(10," By checking this box I declare that I do not have any of these risk factors. "),b.Kb(11,"br"),b.qc(12," \u6211\u920e\u9078\u6b64\u6846\uff0c\u58f0\u660e\u6211\u6ca1\u6709\u4efb\u4f55\u8fd9\u4e9b\u98ce\u9669\u56e0\u7d20\u3002 "),b.Nb(),b.Nb(),b.Nb(),b.Nb()),2&e&&(b.zb(6),b.gc("eventName",n.eventName))},directives:[u.C,u.B,u.e,u.k,m.a,u.x,u.i,c.a],styles:[".modal-custom-class[_ngcontent-%COMP%]   .modal-wrapper[_ngcontent-%COMP%]{background:#222}.modal-custom-class[_ngcontent-%COMP%]{--background:#888a8a;--backdrop-opacity:0}"]}),r),h=i("pLZG"),p=i("aDUK"),f=i("jp9Y"),k=i("t0hA"),N=i("Y+pZ");function C(e,n){if(1&e&&(b.Ob(0,"h3"),b.qc(1),b.Nb()),2&e){var o=b.ac();b.zb(1),b.sc("",o.currentWaitListCount," on wait list")}}var O,y,P,E=[{path:"",component:(O=function(){function n(o,t,i,r,a,c){var s=this;e(this,n),this.formBuilder=o,this.modalController=t,this.activatedRoute=i,this.router=r,this.toastController=a,this.bookingService=c,this.selectedEventUUID="",this.selectedEventName="",this.selectedEventCapacity=40,this.currentPersonBookingCount=0;var l=this.getCreatedNewResetForm(o);this.bookingForm=l,this.bookingForm.valueChanges.subscribe((function(e){console.log("BookingEventPage -> formValChange",e,s.bookingForm)})),i.queryParams.subscribe((function(e){console.log("BookingEventPage -> params",e);var n=r.getCurrentNavigation();if(null!==n&&void 0!==n.extras.state){var o=n.extras.state;console.log("BookingEventPage -> currentNavigation",n);var t=o.randomUUID,i=o.eventName,a=o.eventCapacity;s.selectedEventUUID=t,s.selectedEventName=i,s.selectedEventCapacity=a,s.subscribeToLatestPersonAttendeeCountForSelectedEvent(t,c)}else r.navigate(["/"]).then((function(e){console.log("BookingEventPage -> reNavigate. No navExtras found to book",e)})).catch((function(e){console.log("BookingEventPage -> reNavigate error",e)}))}))}return o(n,[{key:"getCreatedNewResetForm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.formBuilder;return e.group(f.a.createPersonForm())}},{key:"ngOnInit",value:function(){}},{key:"subscribeToLatestPersonAttendeeCountForSelectedEvent",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectedEventUUID,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.bookingService;o.getNumberOfPersonBookingsForEvent(n).pipe(Object(h.a)((function(e){var n,o,t=e.data;return void 0!==(null===(o=null===(n=null==t?void 0:t.PersonBooking_aggregate)||void 0===n?void 0:n.aggregate)||void 0===o?void 0:o.count)}))).subscribe((function(n){var o=n.data.PersonBooking_aggregate.aggregate.count;e.currentPersonBookingCount=o}))}},{key:"onSubmitForm",value:function(e,n){var o=this,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectedEventUUID,i=(arguments.length>3&&void 0!==arguments[3]||this.modalController,arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.bookingForm);arguments.length>5&&void 0!==arguments[5]||this.bookingService,console.log("BookingEventPage -> clickSubmitForm -> eventUUID",t,i.value);var r=i.value;e.control.setErrors({invalid:"Saving form..."});var a=this.presentModal();a.then((function(e){return Object(g.a)(o,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",(console.log("BookingEventPage -> htmlIonModal",e),a));case 1:case"end":return n.stop()}}),n)})))})).then((function(e){return console.log("BookingEventPage -> covidDeclarationModal",e),e.onDidDismiss()})).then((function(e){console.log("BookingEventPage -> overlayEvent",e.data),e.data.isDeclarationChecked&&o.submitSaveBookSeat(t,r)})).catch((function(e){console.log("BookingEventPage -> err",e)}))}},{key:"submitSaveBookSeat",value:function(e,n){var o=this,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.bookingService;t.bookPersonByEventUUID(e,n).subscribe((function(t){var i,r=t.errors,a=t.data;if(void 0!==r||(null==r?void 0:r.length)>0||void 0===(null===(i=a.insert_Person_one)||void 0===i?void 0:i.personFirstName))return console.log("BookingEventPage -> ngOnInit -> data",a),console.log("BookingEventPage -> ngOnInit -> errors",r),console.error("Failed to save"),void o.presentToast("Unable to book. \ud83d\udea7").then((function(e){})).catch((function(e){}));var c=a.insert_Person_one,s=Object.assign({selectedEventUUID:e},n);console.log("BookingEventPage -> ngOnInit -> returnedPerson",c),console.log("BookingEventPage -> ngOnInit -> personFormSubmission",s);var l=JSON.stringify(c),u=JSON.stringify(s);console.log("BookingEventPage -> ngOnInit -> returnedPersonSuccessLocalStorageText personFormSubmissionLocalStorageText",l,u),localStorage.setItem(p.a,l),localStorage.setItem(p.b,u),o.presentToast("\ud83d\udd16\ud83d\udcd1Booking successful \ud83d\udcbe\ud83e\uddfe\ud83d\udcdd\ud83d\udcda\ud83d\udcd7\ud83d\udcd6").then((function(e){})).catch((function(e){})),o.bookingForm=o.getCreatedNewResetForm()}))}},{key:"presentToast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading... \ud83d\udd03",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.toastController;return Object(g.a)(this,void 0,void 0,regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,n.create({message:e,duration:4e3,animated:!0,translucent:!0});case 2:return o.abrupt("return",o.sent.present().then((function(){console.log("Toast presented")})));case 3:case"end":return o.stop()}}),o)})))}},{key:"presentModal",value:function(){return Object(g.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.modalController.create({component:v,cssClass:"modal-custom-class",componentProps:{isDeclarationChecked:!1},swipeToClose:!0,animated:!0,backdropDismiss:!0});case 2:return n=e.sent,e.next=5,n.present().then((function(e){return console.log("COVID declaration model presented",e),n}));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"currentWaitListCount",get:function(){var e=this.currentPersonBookingCount-this.selectedEventCapacity;return e<=0?0:e}},{key:"isCapacityLocked",get:function(){return this.currentPersonBookingCount>=this.selectedEventCapacity}},{key:"isRegistrationAllowed",get:function(){return!this.isCapacityLocked}}]),n}(),O.\u0275fac=function(e){return new(e||O)(b.Jb(l.b),b.Jb(u.F),b.Jb(d.a),b.Jb(d.g),b.Jb(u.I),b.Jb(k.a))},O.\u0275cmp=b.Db({type:O,selectors:[["app-booking-event"]],decls:41,vars:8,consts:[[3,"translucent"],["pageTitle","Book seat"],[3,"formGroup","ngSubmit"],["f","ngForm"],["src","/assets/images/emp-cmca-logo-small-172x172-placeholder.jpg","alt","Placeholder-image-church"],[2,"padding-left","0.5em"],[2,"padding-left","0.55em"],["name","people"],[4,"ngIf"],["position","floating"],["formControlName","personFirstName","type","text","placeholder","First name for registration, check in and contact-tracing purposes","required",""],["formControlName","personLastName","type","text","placeholder","Your last name","required",""],["formControlName","personPhoneNumber","type","tel","placeholder","0412345678","size","12","required",""],["formControlName","personEmailAddress","type","text","placeholder","info@example.com","required",""],["type","submit","color","cobaltblue",3,"disabled"],["name","person-add-outline"],["type","submit","mat-button","","color","primary","hidden","",3,"disabled"],["name","document-text"]],template:function(e,n){if(1&e){var o=b.Pb();b.Ob(0,"ion-header",0),b.Kb(1,"app-custom-header",1),b.Nb(),b.Ob(2,"ion-content"),b.Ob(3,"form",2,3),b.Wb("ngSubmit",(function(e){b.lc(o);var t=b.kc(4);return n.onSubmitForm(t,e)})),b.Ob(5,"ion-list"),b.Ob(6,"ion-list-header"),b.Ob(7,"ion-avatar"),b.Kb(8,"img",4),b.Nb(),b.Ob(9,"ion-label"),b.Ob(10,"h1",5),b.qc(11),b.Nb(),b.Ob(12,"h2",6),b.qc(13),b.Kb(14,"ion-icon",7),b.Nb(),b.oc(15,C,2,1,"h3",8),b.Nb(),b.Nb(),b.Ob(16,"ion-item"),b.Ob(17,"ion-label",9),b.qc(18," First name "),b.Nb(),b.Kb(19,"ion-input",10),b.Nb(),b.Ob(20,"ion-item"),b.Ob(21,"ion-label",9),b.qc(22," Last name "),b.Nb(),b.Kb(23,"ion-input",11),b.Nb(),b.Ob(24,"ion-item"),b.Ob(25,"ion-label",9),b.qc(26," Phone number "),b.Nb(),b.Kb(27,"ion-input",12),b.Nb(),b.Ob(28,"ion-item"),b.Ob(29,"ion-label",9),b.qc(30," Email address "),b.Nb(),b.Kb(31,"ion-input",13),b.Nb(),b.Nb(),b.Ob(32,"ion-row"),b.Ob(33,"ion-col"),b.Ob(34,"div"),b.Ob(35,"ion-button",14),b.Kb(36,"ion-icon",15),b.qc(37," Book seat \ud83d\udcba\ud83d\udcdc "),b.Nb(),b.Ob(38,"button",16),b.Kb(39,"ion-icon",17),b.qc(40," \ud83d\udcba (enter) "),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Nb()}2&e&&(b.gc("translucent",!0),b.zb(3),b.gc("formGroup",n.bookingForm),b.zb(8),b.rc(n.selectedEventName),b.zb(2),b.tc(" ",n.currentPersonBookingCount," attendees registered up to ",n.selectedEventCapacity," "),b.zb(2),b.gc("ngIf",n.currentWaitListCount>0),b.zb(20),b.gc("disabled",n.bookingForm.invalid),b.zb(3),b.gc("disabled",n.bookingForm.invalid))},directives:[u.l,N.a,u.j,l.o,l.k,l.e,u.t,u.u,u.b,u.s,u.m,s.k,u.o,u.n,u.H,l.j,l.d,l.m,u.x,u.i,u.e],styles:[""]}),O)}],B=((P=function n(){e(this,n)}).\u0275mod=b.Hb({type:P}),P.\u0275inj=b.Gb({factory:function(e){return new(e||P)},imports:[[d.i.forChild(E)],d.i]}),P),F=((y=function n(){e(this,n)}).\u0275mod=b.Hb({type:y}),y.\u0275inj=b.Gb({factory:function(e){return new(e||y)},imports:[[s.c,l.f,l.l,u.D,a.a,c.b,B]]}),y)}}])}();