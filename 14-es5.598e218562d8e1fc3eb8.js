!function(){function e(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function t(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return n(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function r(){var e=l(['\n  mutation CreateEvents(\n    $eventInsertObjects: [Event_insert_input!]! = [\n      {\n        EventSeries: { data: { eventSeriesDetails: "Sunday service (English)", eventSeriesName: "Sunday worship" } }\n        Organiser: { data: { randomUUID: "b669fc76-3130-4c4e-a04e-49e9f067ea9c" } }\n      }\n    ]\n  ) {\n    insert_Event(objects: $eventInsertObjects) {\n      affected_rows\n      returning {\n        eventName\n        eventCapacity\n        eventStartDateTime\n        eventEndDateTime\n        bookingAvailableStartDateTime\n        bookingAvailableEndDateTime\n      }\n    }\n  }\n']);return r=function(){return e},e}function c(){var e=l(["\n  mutation CreateEvent($eventInsertObject: Event_insert_input! = {}) {\n    insert_Event_one(object: $eventInsertObject) {\n      randomUUID\n      bookingAvailableStartDateTime\n      bookingAvailableEndDateTime\n      eventStartDateTime\n      eventEndDateTime\n      eventDateTimeRange\n      bookingAvailabilityDateTimeRange\n      eventName\n      eventTopic\n      eventCategory\n      eventCapacity\n      eventDescription\n      eventMedium\n    }\n  }\n"]);return c=function(){return e},e}function s(){var e=l(['\n  # Get all future events.\n  # Default just in case dumb hasura behaviour doesn\'t return EventRooms but somehow returns Events depending on presence of comparison exp\n  subscription GetAllEvents($eventEndDateTimeGreaterThanEqual: timestamptz = "2020-07-28") {\n    Event(\n      where: { eventEndDateTime: { _gte: $eventEndDateTimeGreaterThanEqual } }\n      limit: 20\n      order_by: { eventStartDateTime: asc, eventName: asc, bookingAvailableStartDateTime: asc }\n    ) {\n      eventName\n      eventDescription\n      eventCapacity\n      eventStartDateTime\n      eventEndDateTime\n      bookingAvailableStartDateTime\n      bookingAvailableEndDateTime\n      randomUUID\n      updated_at\n      EventRooms {\n        roomName\n        eventRoomUUID\n        eventRoomDetails\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{oirr:function(n,i,l){"use strict";l.r(i),l.d(i,"EventsPageModule",(function(){return M}));var v,b=l("UKGz"),u=l("SVse"),m=l("s7LF"),d=l("sZkV"),g=l("iInd"),f=l("mrSG"),p=l("LRne"),h=l("IzEk"),E=l("lJxs"),k=l("pLZG"),O=l("ZTNX"),D=l("IxO4"),y=l("8Y7J"),T=l("RXPq"),N=l("lTCR"),I=l.n(N),S=l("Ok9p"),j=l("nbgS"),w=I.a(s()),_=I.a(c()),R=I.a(r()),x=((v=function(){function e(t){o(this,e),this.apollo=t,console.log("EventService -> constructor ")}return a(e,[{key:"getEvents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Object(O.e)(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.apollo;return t.subscribe({query:w,fetchPolicy:"cache-first",variables:{eventEndDateTimeGreaterThanEqual:e}})}},{key:"getSeedEventInputObjects",value:function(){var e,n=Object(D.e)(u.o.Sunday,9,0),o=Object(D.e)(u.o.Sunday,10,30),i=Object(D.e)(u.o.Wednesday,0,0),a=Object(D.e)(u.o.Sunday,23,59,59,999),r=Object(D.d)(n,o,i,a);console.log("EventService -> getSeedEventInputObjects -> recurringDates",r);var c=r.map((function(e){var t=e.eventStartEndDateTime,n=t.startDateTime,o=t.endDateTime,i=t.startEndDateTimeRangeTstzRangeText,a=e.bookingStartEndDateTime,r=a.startDateTime,c=a.endDateTime,s=a.startEndDateTimeRangeTstzRangeText;return[C("English hall","English hall for live stream and in-person services",r,c,s,n,o,i,"Sunday service",40,"Description of community event","Church"),C("Chinese hall","Chinese main hall for live stream and in-person services",r,c,s,n,o,i,"\u4e3b\u65e5\u5d07\u62dc",40,"Description of community event","Church")]}));return(e=[]).concat.apply(e,t(c))}},{key:"createEvents",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.apollo;return t.mutate({mutation:R,variables:{eventInsertObjects:e}})}},{key:"createEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.apollo,t=new Date,n=new Date(t.getTime()-Object(D.b)(2)),o=new Date(t.getTime()+Object(D.b)(7)),i=new Date(t.getTime()+Object(D.b)(9)),a=new Date(t.getTime()+Object(D.b)(10)),r=(new Date(t.getTime()+Object(D.b)(10)),C("English hall","English hall for live stream and in-person services",n,o,Object(D.c)(n,o),i,a,Object(D.c)(i,a)));return console.log("EventService -> constructor -> eventInsertObject",r),e.mutate({mutation:_,variables:{eventInsertObject:r}})}}]),e}()).\u0275fac=function(e){return new(e||v)(y.Sb(j.b))},v.\u0275prov=y.Fb({token:v,factory:v.\u0275fac,providedIn:"root"}),v);function C(e,t,n,o,i,a,r,c){var s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"Sunday service",l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:40,v=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"Description of community event",b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"Church",u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:"b669fc76-3130-4c4e-a04e-49e9f067ea9c";return{bookingAvailableStartDateTime:n,bookingAvailableEndDateTime:o,bookingAvailabilityDateTimeRange:i,eventStartDateTime:a,eventEndDateTime:r,eventDateTimeRange:c,eventName:s,eventTopic:"Topic",eventMedium:"In-person",eventCategory:b,eventCapacity:l,eventDescription:v,Organiser:{data:{randomUUID:u,organiserDetails:""},on_conflict:{constraint:S.g.Organiser_randomUUID_key,update_columns:[S.h.updated_at]}},EventRooms:{data:[{eventRoomDetails:t,Room:{data:{roomName:e,roomType:"Hall",roomCapacity:49,Venue:{data:{venueName:"Eight Mile Plains Chinese Methodist Church",randomUUID:"9cb826dc-fcf8-406e-8b01-f4eba15dfcc6"},on_conflict:{constraint:S.o.Venue_randomUUID_key,update_columns:[S.p.updated_at]}}},on_conflict:{constraint:S.k.Room_venueID_roomName_key,update_columns:[S.l.updated_at]}}}],on_conflict:{constraint:S.c.EventRoom_eventRoomID_eventID_roomID_venueID_roomName_event_key,update_columns:[S.d.updated_at]}}}}var A=l("t0hA"),P=l("Y+pZ");function K(e,t){1&e&&y.Kb(0,"ion-progress-bar",4)}function U(e,t){if(1&e){var n=y.Pb();y.Ob(0,"ion-item-sliding"),y.Ob(1,"ion-item-options"),y.Ob(2,"ion-item-option",5),y.qc(3,"Check "),y.Nb(),y.Nb(),y.Ob(4,"ion-item",6),y.Wb("click",(function(e){y.lc(n);var o=t.$implicit;return y.ac().clickEventItem(e,o)})),y.Ob(5,"ion-avatar",7),y.Kb(6,"img",8),y.Nb(),y.Ob(7,"ion-label",9),y.Ob(8,"h2"),y.qc(9),y.Nb(),y.Ob(10,"h3"),y.qc(11),y.Nb(),y.Ob(12,"p"),y.qc(13),y.bc(14,"date"),y.bc(15,"date"),y.Nb(),y.Nb(),y.Nb(),y.Nb()}if(2&e){var o=t.$implicit,i=y.ac();y.zb(4),y.hc("color",i.isBookingAvailableForEvent(o)?"":"light"),y.gc("button",i.isBookingAvailableForEvent(o)),y.zb(3),y.hc("color",i.isBookingAvailableForEvent(o)?"":"medium"),y.zb(2),y.rc(null==o?null:o.eventName),y.zb(2),y.rc(null==o||null==o.EventRooms[0]?null:o.EventRooms[0].roomName),y.zb(2),y.tc(" ",y.dc(14,7,o.eventStartDateTime,"EEEE',' dd MMM HH:mm"),"\u2013",y.dc(15,10,o.eventEndDateTime,"HH:mm")," ")}}function z(e,t){1&e&&(y.Ob(0,"div"),y.Ob(1,"div",10),y.Kb(2,"ion-skeleton-text",11),y.Kb(3,"ion-skeleton-text",12),y.Kb(4,"ion-skeleton-text",13),y.Kb(5,"ion-skeleton-text",14),y.Kb(6,"ion-skeleton-text",11),y.Nb(),y.Ob(7,"ion-list"),y.Ob(8,"ion-list-header"),y.Ob(9,"ion-label"),y.Kb(10,"ion-skeleton-text",15),y.Nb(),y.Nb(),y.Ob(11,"ion-item"),y.Ob(12,"ion-avatar",7),y.Kb(13,"ion-skeleton-text",12),y.Nb(),y.Ob(14,"ion-label"),y.Ob(15,"h3"),y.Kb(16,"ion-skeleton-text",16),y.Nb(),y.Ob(17,"p"),y.Kb(18,"ion-skeleton-text",17),y.Nb(),y.Ob(19,"p"),y.Kb(20,"ion-skeleton-text",11),y.Nb(),y.Nb(),y.Nb(),y.Ob(21,"ion-item"),y.Ob(22,"ion-thumbnail",7),y.Kb(23,"ion-skeleton-text",12),y.Nb(),y.Ob(24,"ion-label"),y.Ob(25,"h3"),y.Kb(26,"ion-skeleton-text",16),y.Nb(),y.Ob(27,"p"),y.Kb(28,"ion-skeleton-text",17),y.Nb(),y.Ob(29,"p"),y.Kb(30,"ion-skeleton-text",11),y.Nb(),y.Nb(),y.Nb(),y.Ob(31,"ion-item"),y.Kb(32,"ion-skeleton-text",18),y.Ob(33,"ion-label"),y.Ob(34,"h3"),y.Kb(35,"ion-skeleton-text",16),y.Nb(),y.Ob(36,"p"),y.Kb(37,"ion-skeleton-text",17),y.Nb(),y.Ob(38,"p"),y.Kb(39,"ion-skeleton-text",11),y.Nb(),y.Nb(),y.Nb(),y.Nb(),y.Nb())}function q(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date(e);return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(new Date).getTime();return void 0!==e&&t>e.getTime()}(t)}(e.bookingAvailableStartDateTime)}var L,G,J,B=[{path:"",component:(L=function(){function t(e,n,i,a,r,c){o(this,t),this.router=e,this.pwaService=n,this.datePipe=i,this.toastController=a,this.eventService=r,this.bookingService=c,this.upcomingEvents=Object(p.a)([]),this.isLoading=!0,console.log("EventsPage:: constructor")}return a(t,[{key:"ngOnInit",value:function(){var e=this;console.log("EventsPage:: ngOnInit"),this.upcomingEvents=this.getLatestEvents(),this.upcomingEvents.pipe(Object(h.a)(1)).subscribe((function(t){e.isLoading=!1}))}},{key:"getLatestEvents",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.eventService;return console.log("EventsPage:: getLatestEvents"),t.getEvents().pipe(Object(E.a)((function(t){e(t.data);var n=t.errors;if(console.log("EventsPage -> eventsResult",t),!((null==n?void 0:n.length)>0))return console.log("%c EventsPage:: subscribeLatestEvents -> events",O.a),t.data.Event})),Object(k.a)((function(e){var t,n,o;return void 0!==e&&void 0!==(null===(t=e[0])||void 0===t?void 0:t.EventRooms)&&void 0!==(null===(o=null===(n=e[0])||void 0===n?void 0:n.EventRooms[0])||void 0===o?void 0:o.roomName)})))}},{key:"clickEventItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.router;if(console.log("EventsPage -> eventItemClick -> eventItemClick",e),console.log("EventsPage -> eventItemClick -> event",t.randomUUID),q(t))this.navigateToBooking(t,n);else{console.log("EventsPage -> clickEventItem -> event",t);var o=this.datePipe.transform(t.bookingAvailableStartDateTime,D.a);this.presentToast("Booking is currently unavailable for ".concat(t.eventName," <br />Please check back on ").concat(o)).then((function(e){})).catch((function(e){}))}}},{key:"navigateToBooking",value:function(e,t){t.navigate(["/booking"],{state:e}).then((function(e){console.log("EventsPage -> clickEventItem -> navigated ",e)})).catch((function(e){console.log("EventsPage -> clickEventItem -> navigate error",e)}))}},{key:"clickTestButton",value:function(e){console.log("EventsPage -> testButton -> event",e),this.seedEvents()}},{key:"seedEvents",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.eventService,t=e.getSeedEventInputObjects();console.log("EventsPage -> seedEvents -> getSeedEventInputObjects",t),e.createEvents(t).subscribe((function(e){console.log("EventsPage -> seedEvents -> createdEventsResult",e)}))}},{key:"isBookingAvailableForEvent",value:function(e){return void 0!==e&&q(e)}},{key:"presentToast",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.toastController;return Object(f.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.create({message:e,duration:3500,animated:!0,translucent:!0});case 2:return n.abrupt("return",n.sent.present().then((function(){console.log("Toast presented")})));case 3:case"end":return n.stop()}}),n)})))}}]),t}(),L.\u0275fac=function(e){return new(e||L)(y.Jb(g.g),y.Jb(T.a),y.Jb(u.e),y.Jb(d.I),y.Jb(x),y.Jb(A.a))},L.\u0275cmp=y.Db({type:L,selectors:[["app-events"]],decls:9,vars:5,consts:[["pageTitle","COVIDSafe Events"],["value","0.25","buffer","0.50",4,"ngIf"],[4,"ngFor","ngForOf"],[4,"ngIf"],["value","0.25","buffer","0.50"],["color","danger"],[3,"button","color","click"],["slot","start"],["src","/assets/images/emp-cmca-logo-small-172x172-placeholder.jpg","alt","Placeholder-image-church"],[3,"color"],[1,"ion-padding","custom-skeleton"],["animated","",2,"width","60%"],["animated",""],["animated","",2,"width","88%"],["animated","",2,"width","70%"],["animated","",2,"width","20%"],["animated","",2,"width","50%"],["animated","",2,"width","80%"],["animated","","slot","start",2,"width","27px","height","27px"]],template:function(e,t){1&e&&(y.Kb(0,"app-custom-header",0),y.Ob(1,"ion-content"),y.Ob(2,"ion-list"),y.Ob(3,"ion-list-header"),y.qc(4,"Upcoming events"),y.Nb(),y.oc(5,K,1,0,"ion-progress-bar",1),y.oc(6,U,16,13,"ion-item-sliding",2),y.bc(7,"async"),y.Nb(),y.oc(8,z,40,0,"div",3),y.Nb()),2&e&&(y.zb(5),y.gc("ngIf",t.isLoading),y.zb(1),y.gc("ngForOf",y.cc(7,3,t.upcomingEvents)),y.zb(2),y.gc("ngIf",t.isLoading))},directives:[P.a,d.j,d.t,d.u,u.k,u.j,d.v,d.r,d.q,d.p,d.o,d.b,d.s,d.y,d.A],pipes:[u.b,u.e],styles:[""]}),L)}],F=((J=function e(){o(this,e)}).\u0275mod=y.Hb({type:J}),J.\u0275inj=y.Gb({factory:function(e){return new(e||J)},imports:[[g.i.forChild(B)],g.i]}),J),M=((G=function e(){o(this,e)}).\u0275mod=y.Hb({type:G}),G.\u0275inj=y.Gb({factory:function(e){return new(e||G)},imports:[[u.c,m.f,d.D,b.a,F]]}),G)}}])}();