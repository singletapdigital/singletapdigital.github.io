(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{eNtl:function(e,o,n){"use strict";n.r(o),n.d(o,"BookingPageModule",(function(){return k}));var t=n("pMoy"),i=n("UKGz"),s=n("SVse"),r=n("s7LF"),c=n("sZkV"),a=n("iInd"),l=n("mrSG"),b=n("jp9Y"),u=n("t0hA"),d=n("8Y7J"),g=n("h80k"),h=n("T/V+");function m(e,o){if(1&e&&(d.Ob(0,"div"),d.Ob(1,"ion-button",18),d.Kb(2,"ion-icon",19),d.qc(3," Add Person to Booking "),d.Nb(),d.Ob(4,"button",20),d.Kb(5,"ion-icon",21),d.qc(6," Add Person (enter) "),d.Nb(),d.Nb()),2&e){const e=d.ac();d.zb(1),d.gc("disabled",e.bookingForm.invalid),d.zb(3),d.gc("disabled",e.bookingForm.invalid)}}function p(e,o){if(1&e){const e=d.Pb();d.Ob(0,"div"),d.Ob(1,"ion-button",22),d.Wb("click",(function(o){d.lc(e);const n=d.ac(),t=d.kc(8);return n.clickSubmitForm(n.selectedEventUUID,t,o)})),d.qc(2," Register for Sunday service (Chinese hall) "),d.Nb(),d.Nb()}if(2&e){const e=d.ac();d.zb(1),d.gc("disabled",e.bookingForm.invalid)}}function f(e,o){1&e&&(d.Ob(0,"ion-text",23),d.qc(1," Registrations reached maximum capacity "),d.Nb())}const C=[{path:"",component:(()=>{class e{constructor(e,o,n){this.bookingService=e,this.formBuilder=o,this.toastController=n,this.selectedEventUUID="",this.selectedEventName="",this.bookingChineseUUID="445538f0-e22e-4568-acf8-9bc5bba3ceb6",this.bookingEnglishUUID="81508052-8691-4ff4-a3ef-c36bf7fccc88",this.eventChineseUUID="667c1a54-3c59-4eff-a507-b55a80094249",this.eventEnglishUUID="f883134b-661a-4388-b677-582bc2ea39aa",this.latestPersonsEnglishCap=49,this.latestPersonsChineseCap=49;const t=o.group(b.a.createPersonForm());this.bookingForm=t}get isEnglishCountCappedLocked(){return this.englishCount>=this.latestPersonsEnglishCap}get isChineseCountCappedLocked(){return this.chineseCount>=this.latestPersonsChineseCap}get isRegistrationAllowedEnglishCountBelowCap(){return!this.isEnglishCountCappedLocked}get isRegistrationAllowedChineseCountBelowCap(){return!this.isChineseCountCappedLocked}ngOnInit(){console.log("BookingPage -> ngOnInit");const e=Object(u.b)(this.bookingService.getNumberOfPersonBookingsForEvent());this.latestPersonsCountChinese=e,e.subscribe(e=>{this.chineseCount=e});const o=Object(u.b)(this.bookingService.getNumberOfPersonBookingsForEvent(this.eventEnglishUUID));this.latestPersonsCountEnglish=o,o.subscribe(e=>this.englishCount=e)}clickSubmitForm(e="445538f0-e22e-4568-acf8-9bc5bba3ceb6",o,n,t=this.bookingForm,i=this.bookingService){e===this.bookingEnglishUUID?this.englishCount+=1:this.chineseCount+=1,console.log("BookingPage:: clickSubmitForm() -> form",o,n,t);const s=t.value;""!==s.personFirstName?(o.control.setErrors({invalid:"Saving form..."}),i.addPersonToBookingByUUID(e,s).subscribe(e=>{var o,n,t,i;console.log("BookingPage -> clickSubmitForm -> personBookingResult",e),this.presentToast("Successfully saved booking "+(null===(i=null===(t=null===(n=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.insert_Person)||void 0===n?void 0:n.returning)||void 0===t?void 0:t[0])||void 0===i?void 0:i.personFirstName)).catch(),this.resetRecreateForm()},e=>{this.presentToast("Error saving "+JSON.stringify(e)).catch()})):this.presentToast("Invalid inputs detected").catch()}resetRecreateForm(){const e=this.formBuilder.group(b.a.createPersonForm());this.bookingForm=e}presentToast(e="Loading...",o=this.toastController){return Object(l.a)(this,void 0,void 0,(function*(){return(yield o.create({message:e,duration:3500,animated:!0,translucent:!0})).present().then(()=>{console.log("Toast presented")})}))}compare(e,o){return e<o}}return e.\u0275fac=function(o){return new(o||e)(d.Jb(u.a),d.Jb(r.b),d.Jb(c.I))},e.\u0275cmp=d.Db({type:e,selectors:[["app-booking"]],decls:42,vars:6,consts:[[3,"translucent"],["color","cobaltblue"],["slot","start"],[2,"padding-inline-start","0.25em"],[3,"formGroup"],["f","ngForm"],[2,"color","gray"],["col-12","","col-sm-9","","col-md-6","","col-lg-4","","col-xl-3",""],["position","floating"],["formControlName","personFirstName","type","text","placeholder","First name for registration, check in and contact-tracing purposes","required",""],["formControlName","personLastName","type","text","placeholder","Your last name","required",""],["sizeXl","2","sizeLg","2.2","sizeMd","2.5","sizeSm","4","sizeXs","5.6"],["formControlName","personPhoneNumber","type","tel","placeholder","0412345678","size","12","required",""],["formControlName","personEmailAddress","type","text","placeholder","info@example.com","required",""],[3,"eventName"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["maxedChinese",""],["type","button","color","cobaltblue",3,"disabled"],["name","person-add-outline"],["type","button","mat-button","","color","primary","hidden","",3,"disabled"],["name","document-text"],["type","button","color","brightnavyblue",3,"disabled","click"],["color","warning"]],template:function(e,o){if(1&e&&(d.Ob(0,"ion-header",0),d.Ob(1,"ion-toolbar",1),d.Ob(2,"ion-buttons",2),d.Kb(3,"app-home-button"),d.Nb(),d.Ob(4,"ion-title",3),d.qc(5," Booking "),d.Nb(),d.Nb(),d.Nb(),d.Ob(6,"ion-content"),d.Ob(7,"form",4,5),d.Ob(9,"ion-grid"),d.Ob(10,"ion-row",6),d.Ob(11,"ion-col"),d.qc(12," Test"),d.Nb(),d.Nb(),d.Ob(13,"ion-row"),d.Ob(14,"ion-col",7),d.Ob(15,"ion-label",8),d.qc(16," First name "),d.Nb(),d.Kb(17,"ion-input",9),d.Nb(),d.Nb(),d.Ob(18,"ion-row"),d.Ob(19,"ion-col"),d.Ob(20,"ion-label",8),d.qc(21," Last name "),d.Nb(),d.Kb(22,"ion-input",10),d.Nb(),d.Nb(),d.Ob(23,"ion-row"),d.Ob(24,"ion-col",11),d.Ob(25,"ion-label",8),d.qc(26," Phone number "),d.Nb(),d.Kb(27,"ion-input",12),d.Nb(),d.Nb(),d.Ob(28,"ion-row"),d.Ob(29,"ion-col"),d.Ob(30,"ion-label",8),d.qc(31," Email address "),d.Nb(),d.Kb(32,"ion-input",13),d.Nb(),d.Nb(),d.Kb(33,"app-covid-declaration",14),d.Ob(34,"ion-row"),d.Ob(35,"ion-col"),d.oc(36,m,7,2,"div",15),d.Nb(),d.Nb(),d.Ob(37,"ion-row"),d.Ob(38,"ion-col"),d.oc(39,p,3,1,"div",16),d.Nb(),d.Nb(),d.oc(40,f,2,0,"ng-template",null,17,d.pc),d.Nb(),d.Nb(),d.Nb()),2&e){const e=d.kc(41);d.gc("translucent",!0),d.zb(7),d.gc("formGroup",o.bookingForm),d.zb(26),d.gc("eventName",o.selectedEventName),d.zb(3),d.gc("ngIf",o.isRegistrationAllowedEnglishCountBelowCap&&o.isRegistrationAllowedChineseCountBelowCap),d.zb(3),d.gc("ngIf",o.latestPersonsCountEnglish)("ngIfElse",e)}},directives:[c.l,c.C,c.f,g.a,c.B,c.j,r.o,r.k,r.e,c.k,c.x,c.i,c.s,c.n,c.H,r.j,r.d,r.m,h.a,s.k,c.e,c.m,c.z],styles:[""]}),e})()}];let N=(()=>{class e{}return e.\u0275mod=d.Hb({type:e}),e.\u0275inj=d.Gb({factory:function(o){return new(o||e)},imports:[[a.i.forChild(C)],a.i]}),e})(),k=(()=>{class e{}return e.\u0275mod=d.Hb({type:e}),e.\u0275inj=d.Gb({factory:function(o){return new(o||e)},imports:[[s.c,r.f,r.l,c.D,i.a,t.b,N]]}),e})()}}]);