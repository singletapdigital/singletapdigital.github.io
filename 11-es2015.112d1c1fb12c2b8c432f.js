(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{kJmD:function(e,o,t){"use strict";t.r(o),t.d(o,"BookingEventPageModule",(function(){return f}));var n=t("UKGz"),i=t("pMoy"),r=t("SVse"),s=t("s7LF"),a=t("sZkV"),c=t("iInd"),l=t("mrSG"),b=t("8Y7J"),d=t("T/V+");let g=(()=>{class e{constructor(e){this.modalController=e,this.eventName="",console.log("ModalPage -> constructor")}ngOnInit(){console.log("ModalPage -> ngOnInit")}checkChange(e){console.log("ModalPage -> checkChange ",e),this.isDeclarationChecked=e.checked,e.checked&&this.dismiss(e.checked)}dismiss(e=this.isDeclarationChecked,o=this.modalController){o.dismiss({isDeclarationChecked:e}).then(e=>{console.log("ModalPage -> constructor -> a",e)}).catch(e=>{console.log("ModalPage -> constructor -> err",e)})}}return e.\u0275fac=function(o){return new(o||e)(b.Jb(a.F))},e.\u0275cmp=b.Db({type:e,selectors:[["app-modal"]],inputs:{eventName:"eventName"},decls:13,vars:1,consts:[["color","cobaltmonochrome"],["text-left",""],["slot","end","icon-only","","color","triadicred",3,"click"],[3,"eventName"],["size","10"],["id","check-declaration-modal","aria-label","b","required","",3,"change"]],template:function(e,o){1&e&&(b.Ob(0,"ion-toolbar",0),b.Ob(1,"ion-title",1),b.qc(2,"COVID declaration "),b.Nb(),b.Ob(3,"ion-button",2),b.Wb("click",(function(){return o.dismiss(o.isDeclarationChecked)})),b.qc(4," Dismiss "),b.Nb(),b.Nb(),b.Ob(5,"ion-grid"),b.Kb(6,"app-covid-declaration",3),b.Ob(7,"ion-row"),b.Ob(8,"ion-col",4),b.Ob(9,"mat-checkbox",5),b.Wb("change",(function(e){return o.checkChange(e)})),b.qc(10," By checking this box I declare that I do not have any of these risk factors. "),b.Kb(11,"br"),b.qc(12," \u6211\u920e\u9078\u6b64\u6846\uff0c\u58f0\u660e\u6211\u6ca1\u6709\u4efb\u4f55\u8fd9\u4e9b\u98ce\u9669\u56e0\u7d20\u3002 "),b.Nb(),b.Nb(),b.Nb(),b.Nb()),2&e&&(b.zb(6),b.gc("eventName",o.eventName))},directives:[a.C,a.B,a.e,a.k,d.a,a.x,a.i,i.a],styles:[".modal-custom-class[_ngcontent-%COMP%]   .modal-wrapper[_ngcontent-%COMP%]{background:#222}.modal-custom-class[_ngcontent-%COMP%]{--background:#888a8a;--backdrop-opacity:0}"]}),e})();var u=t("pLZG"),m=t("aDUK"),h=t("jp9Y"),v=t("t0hA"),p=t("Y+pZ");function k(e,o){if(1&e&&(b.Ob(0,"h3"),b.qc(1),b.Nb()),2&e){const e=b.ac();b.zb(1),b.sc("",e.currentWaitListCount," on wait list")}}const N=[{path:"",component:(()=>{class e{constructor(e,o,t,n,i,r){this.formBuilder=e,this.modalController=o,this.activatedRoute=t,this.router=n,this.toastController=i,this.bookingService=r,this.selectedEventUUID="",this.selectedEventName="",this.selectedEventCapacity=40,this.currentPersonBookingCount=0;const s=this.getCreatedNewResetForm(e);this.bookingForm=s,this.bookingForm.valueChanges.subscribe(e=>{console.log("BookingEventPage -> formValChange",e,this.bookingForm)}),t.queryParams.subscribe(e=>{console.log("BookingEventPage -> params",e);const o=n.getCurrentNavigation();if(null===o||void 0===o.extras.state)return void n.navigate(["/"]).then(e=>{console.log("BookingEventPage -> reNavigate. No navExtras found to book",e)}).catch(e=>{console.log("BookingEventPage -> reNavigate error",e)});const{extras:{state:t}}=o;console.log("BookingEventPage -> currentNavigation",o);const{randomUUID:i,eventName:s,eventCapacity:a}=t;this.selectedEventUUID=i,this.selectedEventName=s,this.selectedEventCapacity=a,this.subscribeToLatestPersonAttendeeCountForSelectedEvent(i,r)})}get currentWaitListCount(){const e=this.currentPersonBookingCount-this.selectedEventCapacity;return e<=0?0:e}get isCapacityLocked(){return this.currentPersonBookingCount>=this.selectedEventCapacity}get isRegistrationAllowed(){return!this.isCapacityLocked}getCreatedNewResetForm(e=this.formBuilder){return e.group(h.a.createPersonForm())}ngOnInit(){}subscribeToLatestPersonAttendeeCountForSelectedEvent(e=this.selectedEventUUID,o=this.bookingService){o.getNumberOfPersonBookingsForEvent(e).pipe(Object(u.a)(({data:e})=>{var o,t;return void 0!==(null===(t=null===(o=null==e?void 0:e.PersonBooking_aggregate)||void 0===o?void 0:o.aggregate)||void 0===t?void 0:t.count)})).subscribe(({data:{PersonBooking_aggregate:{aggregate:{count:e}}}})=>{this.currentPersonBookingCount=e})}onSubmitForm(e,o,t=this.selectedEventUUID,n=this.modalController,i=this.bookingForm,r=this.bookingService){console.log("BookingEventPage -> clickSubmitForm -> eventUUID",t,i.value);const s=i.value;e.control.setErrors({invalid:"Saving form..."});const a=this.presentModal();a.then(e=>Object(l.a)(this,void 0,void 0,(function*(){return console.log("BookingEventPage -> htmlIonModal",e),a}))).then(e=>(console.log("BookingEventPage -> covidDeclarationModal",e),e.onDidDismiss())).then(e=>{console.log("BookingEventPage -> overlayEvent",e.data);const{data:{isDeclarationChecked:o}}=e;o&&this.submitSaveBookSeat(t,s)}).catch(e=>{console.log("BookingEventPage -> err",e)})}submitSaveBookSeat(e,o,t=this.bookingService){t.bookPersonByEventUUID(e,o).subscribe(({errors:t,data:n})=>{var i;if(void 0!==t||(null==t?void 0:t.length)>0||void 0===(null===(i=n.insert_Person_one)||void 0===i?void 0:i.personFirstName))return console.log("BookingEventPage -> ngOnInit -> data",n),console.log("BookingEventPage -> ngOnInit -> errors",t),console.error("Failed to save"),void this.presentToast("Unable to book. \u{1f6a7}").then(e=>{}).catch(e=>{});const r=n.insert_Person_one,s=Object.assign({selectedEventUUID:e},o);console.log("BookingEventPage -> ngOnInit -> returnedPerson",r),console.log("BookingEventPage -> ngOnInit -> personFormSubmission",s);const a=JSON.stringify(r),c=JSON.stringify(s);console.log("BookingEventPage -> ngOnInit -> returnedPersonSuccessLocalStorageText personFormSubmissionLocalStorageText",a,c),localStorage.setItem(m.a,a),localStorage.setItem(m.b,c),this.presentToast("\u{1f516}\u{1f4d1}Booking successful \u{1f4be}\u{1f9fe}\u{1f4dd}\u{1f4da}\u{1f4d7}\u{1f4d6}").then(e=>{}).catch(e=>{}),this.bookingForm=this.getCreatedNewResetForm()})}presentToast(e="Loading... \u{1f503}",o=this.toastController){return Object(l.a)(this,void 0,void 0,(function*(){return(yield o.create({message:e,duration:4e3,animated:!0,translucent:!0})).present().then(()=>{console.log("Toast presented")})}))}presentModal(){return Object(l.a)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({component:g,cssClass:"modal-custom-class",componentProps:{isDeclarationChecked:!1},swipeToClose:!0,animated:!0,backdropDismiss:!0});return yield e.present().then(o=>(console.log("COVID declaration model presented",o),e))}))}}return e.\u0275fac=function(o){return new(o||e)(b.Jb(s.b),b.Jb(a.F),b.Jb(c.a),b.Jb(c.g),b.Jb(a.I),b.Jb(v.a))},e.\u0275cmp=b.Db({type:e,selectors:[["app-booking-event"]],decls:41,vars:8,consts:[[3,"translucent"],["pageTitle","Book seat"],[3,"formGroup","ngSubmit"],["f","ngForm"],["src","/assets/images/emp-cmca-logo-small-172x172-placeholder.jpg","alt","Placeholder-image-church"],[2,"padding-left","0.5em"],[2,"padding-left","0.55em"],["name","people"],[4,"ngIf"],["position","floating"],["formControlName","personFirstName","type","text","placeholder","First name for registration, check in and contact-tracing purposes","required",""],["formControlName","personLastName","type","text","placeholder","Your last name","required",""],["formControlName","personPhoneNumber","type","tel","placeholder","0412345678","size","12","required",""],["formControlName","personEmailAddress","type","text","placeholder","info@example.com","required",""],["type","submit","color","cobaltblue",3,"disabled"],["name","person-add-outline"],["type","submit","mat-button","","color","primary","hidden","",3,"disabled"],["name","document-text"]],template:function(e,o){if(1&e){const e=b.Pb();b.Ob(0,"ion-header",0),b.Kb(1,"app-custom-header",1),b.Nb(),b.Ob(2,"ion-content"),b.Ob(3,"form",2,3),b.Wb("ngSubmit",(function(t){b.lc(e);const n=b.kc(4);return o.onSubmitForm(n,t)})),b.Ob(5,"ion-list"),b.Ob(6,"ion-list-header"),b.Ob(7,"ion-avatar"),b.Kb(8,"img",4),b.Nb(),b.Ob(9,"ion-label"),b.Ob(10,"h1",5),b.qc(11),b.Nb(),b.Ob(12,"h2",6),b.qc(13),b.Kb(14,"ion-icon",7),b.Nb(),b.oc(15,k,2,1,"h3",8),b.Nb(),b.Nb(),b.Ob(16,"ion-item"),b.Ob(17,"ion-label",9),b.qc(18," First name "),b.Nb(),b.Kb(19,"ion-input",10),b.Nb(),b.Ob(20,"ion-item"),b.Ob(21,"ion-label",9),b.qc(22," Last name "),b.Nb(),b.Kb(23,"ion-input",11),b.Nb(),b.Ob(24,"ion-item"),b.Ob(25,"ion-label",9),b.qc(26," Phone number "),b.Nb(),b.Kb(27,"ion-input",12),b.Nb(),b.Ob(28,"ion-item"),b.Ob(29,"ion-label",9),b.qc(30," Email address "),b.Nb(),b.Kb(31,"ion-input",13),b.Nb(),b.Nb(),b.Ob(32,"ion-row"),b.Ob(33,"ion-col"),b.Ob(34,"div"),b.Ob(35,"ion-button",14),b.Kb(36,"ion-icon",15),b.qc(37," Book seat \u{1f4ba}\u{1f4dc} "),b.Nb(),b.Ob(38,"button",16),b.Kb(39,"ion-icon",17),b.qc(40," \u{1f4ba} (enter) "),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Nb(),b.Nb()}2&e&&(b.gc("translucent",!0),b.zb(3),b.gc("formGroup",o.bookingForm),b.zb(8),b.rc(o.selectedEventName),b.zb(2),b.tc(" ",o.currentPersonBookingCount," attendees registered up to ",o.selectedEventCapacity," "),b.zb(2),b.gc("ngIf",o.currentWaitListCount>0),b.zb(20),b.gc("disabled",o.bookingForm.invalid),b.zb(3),b.gc("disabled",o.bookingForm.invalid))},directives:[a.l,p.a,a.j,s.o,s.k,s.e,a.t,a.u,a.b,a.s,a.m,r.k,a.o,a.n,a.H,s.j,s.d,s.m,a.x,a.i,a.e],styles:[""]}),e})()}];let C=(()=>{class e{}return e.\u0275mod=b.Hb({type:e}),e.\u0275inj=b.Gb({factory:function(o){return new(o||e)},imports:[[c.i.forChild(N)],c.i]}),e})(),f=(()=>{class e{}return e.\u0275mod=b.Hb({type:e}),e.\u0275inj=b.Gb({factory:function(o){return new(o||e)},imports:[[r.c,s.f,s.l,a.D,n.a,i.b,C]]}),e})()}}]);